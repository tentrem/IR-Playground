---
description: Malware Analysis & Response Playbook
---

# Malware IR Playbook

Workflow untuk menangani incident terkait malware. Fokus pada **identifikasi, containment, dan analisis**.

## Kapan Pakai Workflow Ini?

- Alert AV/EDR mendeteksi malware
- User report file mencurigakan
- Proses suspicious ditemukan saat triage

## Prerequisites

- [ ] Sudah triage awal → `/ir-triage`
- [ ] Tahu hostname/IP sistem terinfeksi
- [ ] Evidence folder siap

---

## 1. Identifikasi Malware

### Cek Alert dari EDR/AV

```
Cari di SIEM/EDR:
- Nama file malware
- Hash (MD5/SHA256)
- Path lokasi file
- Timestamp deteksi
- Action yang diambil (quarantine/block/allow)
```

### Lookup Hash di VirusTotal

```
Cari hash di:
1. https://www.virustotal.com
2. https://www.hybrid-analysis.com
3. https://any.run

Catat:
- Detection ratio
- Malware family/type
- Behavior (C2, persistence, etc.)
```

---

## 2. Containment

### Isolasi Sistem

Jika malware aktif dan berbahaya, isolasi segera:

```bash
# Linux
ssh TARGET "iptables -I INPUT -j DROP; iptables -I OUTPUT -j DROP"

# Windows (PowerShell remote)
Invoke-Command -ComputerName TARGET -ScriptBlock {
    New-NetFirewallRule -DisplayName "IR-BlockAll" -Direction Outbound -Action Block
}
```

### Kill Proses (Jika Diketahui)

```bash
# Linux - kill by name
ssh TARGET "pkill -9 malware_name"

# Windows
Invoke-Command -ComputerName TARGET -ScriptBlock {
    Stop-Process -Name "malware_name" -Force
}
```

---

## 3. Collect Evidence

### Ambil Sample Malware

```bash
# Linux - copy file suspicious
scp TARGET:/path/to/malware.exe evidence/malware/

# Windows
Copy-Item "\\TARGET\C$\path\to\malware.exe" -Destination "evidence\malware\"
```

### Hash File

```bash
# Linux
sha256sum evidence/malware/malware.exe > evidence/malware/hash.txt

# Windows
Get-FileHash evidence\malware\malware.exe | Out-File evidence\malware\hash.txt
```

### Collect Memory (Optional)

Jika butuh analisis memory untuk malware fileless:

- Linux: LiME module
- Windows: WinPMEM atau Volatility

---

## 4. Analisis dengan AI

```
Saya punya malware sample dengan karakteristik:
- Hash: [SHA256]
- VirusTotal Detection: [ratio]
- Lokasi ditemukan: [path]
- Behavior yang terdeteksi: [list behaviors]

Tolong bantu:
1. Identifikasi malware family
2. MITRE ATT&CK techniques yang digunakan
3. IOC yang harus di-block
4. Cara eradikasi
```

---

## 5. Eradikasi

### Hapus Malware File

```bash
# Linux
ssh TARGET "rm -f /path/to/malware.exe"

# Windows
Invoke-Command -ComputerName TARGET -ScriptBlock {
    Remove-Item "C:\path\to\malware.exe" -Force
}
```

### Hapus Persistence

Cek dan hapus:

- [ ] Scheduled Tasks / Cron jobs
- [ ] Registry Run keys (Windows)
- [ ] Startup folders
- [ ] Services yang dibuat malware

### Scan Ulang

```bash
# Jalankan full scan dengan AV
# Pastikan AV definition ter-update

# Windows Defender
Invoke-Command -ComputerName TARGET -ScriptBlock {
    Start-MpScan -ScanType FullScan
}
```

---

## 6. Post-Incident

- [ ] Buat detection rule di SIEM → `/ir-report-template`
- [ ] Update IOC blocklist
- [ ] Patch vulnerability yang diexploit (jika ada)
- [ ] Brief team tentang malware type

---

## Quick Reference: Common Malware Locations

### Windows

```
C:\Users\*\AppData\Local\Temp\
C:\Users\*\AppData\Roaming\
C:\Windows\Temp\
C:\ProgramData\
C:\Windows\System32\ (fake dll)
```

### Linux

```
/tmp/
/var/tmp/
/dev/shm/
/home/*/.cache/
/usr/local/bin/ (fake binaries)
```

---

## Checklist Summary

- [ ] Malware identified (hash, family)
- [ ] System isolated (if needed)
- [ ] Sample collected & hashed
- [ ] Malware removed
- [ ] Persistence cleaned
- [ ] Full scan clean
- [ ] Detection rule created
- [ ] Report generated → `/ir-report-template`
